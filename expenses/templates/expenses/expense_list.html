{% extends "base.html" %}

{% block content %}

    <a href="{% url 'expenses:expense-create' %}">add</a>
    <div class="container">
        <form class="form-group" method="get" action="">
            {{ form.as_p }}
            <button type="submit">search</button>
        </form>
    </div>
    <br>

    <table id="expenses" class="table table-striped table-bordered table-sm" cellspacing="0" style="width:50%;">
        <caption>Expenses</caption>
        <thead>
        <tr>
            <th>no.</th>
            <th>category</th>
            <th>name</th>
            <th>amount</th>
            <th>date</th>
            <th>actions</th>
        </tr>
        </thead>
        <tbody>
        {% for obj in object_list %}
            <tr>
                <td>{{ page_obj.start_index|add:forloop.counter0 }}.</td>
                <td>{{ obj.category|default:"-" }}</td>
                <td>{{ obj.name|default:"-" }}</td>
                <td>{{ obj.amount|floatformat:2 }}</td>
                <td>{{ obj.date }}</td>
                <td>
                    <a href="{% url 'expenses:expense-edit' obj.id %}">edit</a>
                    <a href="{% url 'expenses:expense-delete' obj.id %}">delete</a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="5">no items</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="center">
        {% include "_pagination.html" %}
    </div>
    <hr>
    <div class="center">
        <table class="table table-striped table-bordered table-sm" style="width:50%;">
            <caption>Summary per category</caption>

            {% for category, total in summary_per_category.items %}
                <tr>
                    <td>{{ category }}:</td>
                    <td>{{ total|floatformat:2 }}</td>
                </tr>
            {% endfor %}
            <tr style="font-weight: bold;">
                <td>Total amount spent:</td>
                <td>
                    {{ total_amount|floatformat:2 }}
                </td>
            </tr>
        </table>
    </div>
    <hr>
    <table id="summary_per_year_month" class="table table-striped table-bordered table-sm" cellspacing="0"
           style="width:50%;">
        <caption>Summary per year-month</caption>
        <thead>
        <tr>
            <th>year-month</th>
            <th>total summary</th>
        </tr>
        </thead>
        <tbody>
        {% for year_month, summary in summary_per_year_month.items %}
            <tr>
                <td>{{ year_month }}</td>
                <td>{{ summary|floatformat:2 }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            $('#expenses').DataTable({searching: false, paging: false, info: false});
            $('#summary_per_year_month').DataTable({searching: false, paging: false, info: false});
            $('.dataTables_length').addClass('bs-select');
        });
    </script>
{% endblock %}
